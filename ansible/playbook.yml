---
- name: Set up container environment
  hosts: webserver
  become: true
  gather_facts: true
  vars:
    ansible_python_interpreter: /usr/bin/python3  # Sp√©cifie explicitement le chemin de Python 3 pour Ansible

  tasks:
    - name: Ensure Python 3 is the default interpreter
      command: update-alternatives --install /usr/bin/python3 python /usr/bin/python3 1

    - name: Ensure pip3 for Python 3 is installed
      apt:
        name: python3-pip
        state: present

    - name: Check Python version
      command: python3 --version
      register: python_version

    - name: Display Python version
      debug:
        msg: "Python version is {{ python_version.stdout }}"

    - name: Ensure required Python packages are installed
      pip:
        name:
          - setuptools
          - pip
          - cryptography
          - ansible
        state: present
        executable: /usr/bin/pip3  # Utilisation de pip3

    - name: Ensure Docker is installed (for container environment)
      apt:
        name: docker.io
        state: present

    - name: Ensure Docker service is started
      service:
        name: docker
        state: started
        enabled: true

    - name: Ensure Keycloak is installed
      apt:
        name: keycloak
        state: present

  roles:
    - common
    - docker
    - keycloak
    - webserver
